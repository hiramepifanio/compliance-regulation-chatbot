# Regulation Compliance Chatbot

A high-fidelity RAG (Retrieval-Augmented Generation) system built to query and analyze compliance documents (PDF/HTML).

## My approach
Before you get to the code, let me explain my approach.

### AI-first Engineering
To build this project, I've used Google's Antigravity tool to generate the code. About 90% of the code was generated by this tool, but I made sure to understand the code and modify it to fit my needs.

I usually follow this process:
1. Instead of prompting "Build X feature for me", I prompt "I want to build X feature. How can I architect it? What are the industry standards? Propose several implementation strategies and their trade-offs."
2. I then analyze the options, compare their trade-offs and choose the best one.
3. Once everything is planned, I ask the tool to implement it.
4. I then analyze the code and make sure it's correct.

To keep context of the architectural decisions, I use these files:
- **PRD.md**: Captures the high-level objectives and requirements.
- **AGENTS.md**: It's where I direct how the tool should implement the project (Tech stack, coding standards, etc).
- **docs Folder**: It's where I keep the documentation of the project. At the end of each coding session, I add a summary of what has been built for future reference.

### Engineering decisions
- **Data Ingestion**: To follow the "less code is usually better" principle, I've decided to:
    - Ingest `FMD_Test_Corporation.pdf` and `part_measurements_test_corporation.html` as one chunk each, since they are small files.
    - Ingest `REACH_Certificate_of_Compliance_Test_Corporation.pdf` as multiple documents, chunking each section.
    - This approach allows us to keep the code simple while making it possible to track data from the larger document.
- **Grounding**:
    - I've decided to use a grounding threshold of 0.5 for similarity scores from RAG retrievals.
    - While this value might seem low, empirical testing demonstrated a good balance between recall and precision.
    - 16 out of 17 (94%) questions were correctly answered with no hallucinations (you can find these sample questions in `docs/compliance_questions.md`).

## üöÄ Overview

This system allows you to ask natural language questions about specific regulation documents. It uses a **Structural Ingestion Pipeline** to preserve the integrity of tables and headers, and a **Grounded Retrieval System** to prevent hallucinations.

### Tech Stack
- **Language**: Python 3.12+
- **LLM**: Google Gemini 3 Flash / 1.5 Flash
- **Vector DB**: ChromaDB (Local-first)
- **Frameworks**: LangChain, Pydantic, PyMuPDF4LLM

## üõ†Ô∏è Setup Instructions

### 0. Cloning
Clone this repository:
```bash
git clone https://github.com/hiramepifanio/compliance-regulation-chatbot.git
cd compliance-regulation-chatbot
```

### 1. Environment Setup
Create a virtual environment and install dependencies:
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
export PYTHONPATH=$PYTHONPATH:$(pwd)
```

### 2. Configuration
Create a `.env` file in the root directory (see `.env.example`):
```env
GOOGLE_API_KEY=your_api_key_here
LLM_MODEL=gemini-3-flash-preview
GROUNDING_THRESHOLD=0.5
```
*Note: A `GROUNDING_THRESHOLD` of 0.5 is recommended for optimal recall with conservative embedding scores.*

## üîç Usage

The system automatically manages document ingestion. The first time you run it, or if the database is empty, it will index the documents in the `/data` folder before answering your query.

### Single Query
Run a single query WITH LOGS (RECOMMENDED: use verbose mode for ingestion logs and confidence scores):
```bash
python3 src/main.py "How much lead is in part TC-3541-A?" -v
```

Run a single query WITHOUT LOGS:
```bash
python3 src/main.py "How much lead is in part TC-3541-A?"
```

### Interactive Mode
Enter interactive mode (ingestion will still happen automatically if needed):
```bash
python3 src/main.py
```

### Database Management
To clear the database and force a fresh re-ingestion:
```bash
python3 src/main.py --wipe
```

### Options
- `-v`, `--verbose`: Show detailed logs (ingestion progress, retrieval confidence, etc.).
- `--wipe`: Clear the local vector database before starting.

## üß™ Evaluation & Testing

### Automated Tests
Run logic and unit tests:
```bash
pytest
```

## üìÇ Project Structure
- `src/parser.py`: Structural conversion of PDF/HTML to Markdown.
- `src/ingestion.py`: Orchestrates vector store indexing.
- `src/retriever.py`: Similarity search with grounding threshold logic.
- `src/inference.py`: Structured JSON response generation via Gemini.
- `src/main.py`: CLI Entry point.
- `docs/`: Detailed design and engineering analysis.
